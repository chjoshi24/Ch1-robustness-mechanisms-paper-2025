---
title: "ch1_data_analysis"
author: "Chinmay Joshi"
date: "2023-02-07"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Required libraries
```{r}
library(tidyverse)
library(ggplot2)
library(ggthemes)
library(ggstats)
```


Importing the datasheets,and converting the relevant columns into factors.
Low sucrose experiment- 1.5 M sucrose
High sucrose experiment- 3 M sucrose
```{r}

low_sucrose_experiment_data<-read.csv("Combined ant choices_Low sucrose experiment.csv")

high_sucrose_experiment_data<-read.csv("Combined ant choices_High sucrose experiment.csv")

#Extracting the columns needed for choice and abandonment analysis
low_sucrose_experiment_choices<-data.frame(low_sucrose_experiment_data$Treatment,low_sucrose_experiment_data$Ant.choice)
high_sucrose_experiment_choices<-data.frame(high_sucrose_experiment_data$Treatment,high_sucrose_experiment_data$Ant.choice)

#Changing the column names
colnames(low_sucrose_experiment_choices)<-c("treatment","choices")
colnames(high_sucrose_experiment_choices)<-c("treatment","choices")

#Converting the columns into factors
low_sucrose_experiment_choices$treatment<-as.factor(low_sucrose_experiment_choices$treatment)
low_sucrose_experiment_choices$choices<-as.factor(low_sucrose_experiment_choices$choices)

high_sucrose_experiment_choices$treatment<-as.factor(high_sucrose_experiment_choices$treatment)
high_sucrose_experiment_choices$choices<-as.factor(high_sucrose_experiment_choices$choices)

#Creating labels specific to the experiment for the analysis below

#These two dataframes are used for the choice analyses below
low_sucrose_experiment_choices$label<-as.factor(ifelse(low_sucrose_experiment_choices$treatment=="Control","Control_1.5m","Exp_1.5m"))

high_sucrose_experiment_choices$label<-as.factor(ifelse(high_sucrose_experiment_choices$treatment=="Control","Control_3m","Exp_3m"))

#Ants stay on the trail when they are making a choice vs. when they abandon. So creating another column using the data above to indicate that. These two dataframes will be used for the abandonment analyses below

low_sucrose_experiment_abandonment<-low_sucrose_experiment_choices %>%
mutate(abandonment=ifelse(low_sucrose_experiment_choices$choices=="Abandoned","Abandoned","On-trail"))

low_sucrose_experiment_abandonment<-low_sucrose_experiment_abandonment[,c(1,3,4)]

high_sucrose_experiment_abandonment<-high_sucrose_experiment_choices %>% mutate(abandonment= ifelse(high_sucrose_experiment_choices$choices=="Abandoned","Abandoned","On-trail"))

high_sucrose_experiment_abandonment<-high_sucrose_experiment_abandonment[,c(1,3,4)]


```


1) Analyzing ant choices for low and high sucrose experiments

```{r}
#Filtering data where ants made either a correct or a wrong choice
low_sucrose_experiment_choices_only<-
  low_sucrose_experiment_choices %>% 
  filter(choices !="Abandoned")

high_sucrose_experiment_choices_only<-
  high_sucrose_experiment_choices %>%
  filter(choices !="Abandoned")

#Dropping the abandonment factor level
low_sucrose_experiment_choices_only$choices<-droplevels(low_sucrose_experiment_choices_only$choices)

high_sucrose_experiment_choices_only$choices<-droplevels(high_sucrose_experiment_choices_only$choices)

#Creating tables for the binomial and Chi-square tests 
low_sucrose_experiment_choices_only_table<-table(low_sucrose_experiment_choices_only[-3])

high_sucrose_experiment_choices_only_table<-table(high_sucrose_experiment_choices_only[-3])

#Binomial test for control treatments (Extracting relevant entries from the above choice tables)

binom.test(low_sucrose_experiment_choices_only_table[1],low_sucrose_experiment_choices_only_table[1]+low_sucrose_experiment_choices_only_table[3],0.5)

binom.test (high_sucrose_experiment_choices_only_table[1],high_sucrose_experiment_choices_only_table[1]+high_sucrose_experiment_choices_only_table[3],0.5)
#Significant!


#Binomial test for experimental treatments(Extracting relevant entries from the above choice tables) 
binom.test(low_sucrose_experiment_choices_only_table[2],low_sucrose_experiment_choices_only_table[2]+low_sucrose_experiment_choices_only_table[4],0.5)
#Not significant 

binom.test(high_sucrose_experiment_choices_only_table[2],high_sucrose_experiment_choices_only_table[2]+high_sucrose_experiment_choices_only_table[4],0.5)
#Non-significant 


#Chi-square tests to test whether proportion of correct choices are more in the control vs. experimental treatments across both experiments (Using the entire choice tables from above)

chisq.test(low_sucrose_experiment_choices_only_table,correct = F)
#Significant

chisq.test(high_sucrose_experiment_choices_only_table,correct = F)
#Significant

```


2) Comparing low and high sucrose experiments to examine whether the increased resource value resulted in changes in proportion of correct choices when the trail was perturbed.

Labels:
1.5m-Low sucrose experiment
3m- High sucrose experiment
```{r}
 
#Combining the choices from both experiments from the above data frames
all_exp_combined_data_choices<-rbind(low_sucrose_experiment_choices_only,high_sucrose_experiment_choices_only)

#Subsetting the data for each of the two treatments to compare between the experiments
all_exp_combined_control<-subset(all_exp_combined_data_choices,all_exp_combined_data_choices$treatment=="Control")

all_exp_combined_experimental<-subset(all_exp_combined_data_choices,all_exp_combined_data_choices$treatment=="Experimental")

#Dropping the unecessary factor levels for each dataframe
all_exp_combined_control$label<-droplevels(all_exp_combined_control$label)

all_exp_combined_experimental$label<-droplevels(all_exp_combined_experimental$label)

# Comparing proportion of correct choices for control and experimental treatments between the two experiments  
 
#Control treatment
all_exp_combined_control_choices_only<-data.frame(all_exp_combined_control$choices,all_exp_combined_control$label)

#Relabeling the columns and creating a table for the chi-sqaure test
colnames(all_exp_combined_control_choices_only)<-c("choices","exp_type")

all_exp_combined_control_choices_only_table<-table(all_exp_combined_control_choices_only)

#Chi-square test
chisq.test(all_exp_combined_control_choices_only_table,correct = F)
#Not significant

#Experimental treatment

all_exp_combined_experimental_choices_only<-data.frame(all_exp_combined_experimental$choices,all_exp_combined_experimental$label)

#Relabeling the columns and creating a table for chi-sqaure tests
colnames(all_exp_combined_experimental_choices_only)<-c("choices","exp_type")

all_exp_combined_experimental_choices_only_table<-table(all_exp_combined_experimental_choices_only)

chisq.test(all_exp_combined_experimental_choices_only_table,correct = F)
#Not significant

```


2) Analyzing ant abandonment for low and high sucrose experiments

```{r}

#Creating tables for the binomial and Chi-square tests using the dataframes defined above 
low_sucrose_experiment_abandonment_table<-table(low_sucrose_experiment_abandonment[-2])
high_sucrose_experiment_abandonment_table<-table(high_sucrose_experiment_abandonment[-2])

#Chi-square tests on the above table
chisq.test(low_sucrose_experiment_abandonment_table,correct = F)
#Significant

chisq.test(high_sucrose_experiment_abandonment_table,correct = F)
#Significant

#Binomial test for control treatments (Extracting relevant entries from the above choice tables)
binom.test(low_sucrose_experiment_abandonment_table[1],low_sucrose_experiment_abandonment_table[1]+low_sucrose_experiment_abandonment_table[3],0.5)
#Significant difference

binom.test(high_sucrose_experiment_abandonment_table[1],high_sucrose_experiment_abandonment_table[1]+high_sucrose_experiment_abandonment_table[3],0.5)
#Significant difference

 
#Binomial test for experimental treatments(Extracting relevant entries from the above choice tables) 

binom.test(low_sucrose_experiment_abandonment_table[2],low_sucrose_experiment_abandonment_table[2]+low_sucrose_experiment_abandonment_table[4],0.5)
#Significant difference

binom.test(high_sucrose_experiment_abandonment_table[2],high_sucrose_experiment_abandonment_table[2]+high_sucrose_experiment_abandonment_table[4],0.5)
#Not significant 

```


Comparing abandonment across both experiments.

Labels:
1.5m-Low sucrose experiment
3m- High sucrose experiment

```{r}

#Combining abandonment data across both experiments
all_exp_combined_abandonment_only<-rbind(low_sucrose_experiment_abandonment,high_sucrose_experiment_abandonment)

#Control treatment comparison

all_exp_combined_control_abandonment_only<-all_exp_combined_abandonment_only %>% filter(treatment=="Control")

#Converting the column into a factor and removing uncessary factor levels
all_exp_combined_control_abandonment_only$abandonment<-as.factor(all_exp_combined_control_abandonment_only$abandonment)

all_exp_combined_control_abandonment_only$label<-droplevels(all_exp_combined_control_abandonment_only$label)

#Creating table for the chi-square test
all_exp_combined_control_abandonment_only_table<-table(all_exp_combined_control_abandonment_only[-1])

#Chi-square test
chisq.test(all_exp_combined_control_abandonment_only_table,correct = F)
#Not significant

#Experimental treatment comparison

all_exp_combined_experimental_abandonment_only<-all_exp_combined_abandonment_only %>% filter(treatment=="Experimental")

#Converting the column into a factor and removing uncessary factor levels
all_exp_combined_experimental_abandonment_only$abandonment<-as.factor(all_exp_combined_experimental_abandonment_only$abandonment)

all_exp_combined_experimental_abandonment_only$label<-droplevels(all_exp_combined_experimental_abandonment_only$label)

#Creating table for the chi-square test
all_exp_combined_experimental_abandonment_only_table<-table(all_exp_combined_experimental_abandonment_only[-1])

#Chi-square test
chisq.test(all_exp_combined_experimental_abandonment_only_table,correct = F)
#Significant!

```


Stacked barplots for choices across both experiments
```{r}

#Calculating the proportion of correct vs. wrong choices for the graph 
choices_combined<-as.data.frame(all_exp_combined_data_choices %>%
  group_by(label,choices)%>%
  summarize(total=n())%>%
  group_by(label) %>%
  mutate(
    percent = total / sum(total) * 100
  ))

#Barplot with individual sample sizes for both experiments
ggplot(choices_combined, aes(x = label, y = percent, fill = choices)) +
  geom_bar(stat = "identity", color = "black") +
  geom_text(
    aes(label = paste0("n=", total)),
    position = position_stack(vjust = 0.5),
    size = 6,           
    color = "white"
  ) +
  scale_y_continuous() +
  labs(x = "", y = "Proportion of ants", fill = "Choices") +   
  theme_minimal(base_size = 14) +
  theme(
    axis.text.x = element_text(size = 13),
    axis.title.y = element_text(size = 22),
    axis.text.y = element_text(size = 18), 
    legend.title = element_text(size = 20),            
    panel.grid.major.x = element_blank()
  ) +geom_hline(yintercept = 50, linetype = "dashed")+
  scale_x_discrete(labels=c("Control_1.5m"="Control(1.5 M)","Control_3m"= "Control(3 M)", "Exp_1.5m"="Experimental(1.5 M)","Exp_3m" = "Experimental(3 M)"))+
  guides(fill=guide_legend(title="Choices"))


```

BARCHARTS OF ABANDONMENT ACROSS BOTH EXPERIMENTS
```{r}
 
abandonment_combined<-as.data.frame(all_exp_combined_abandonment_only %>%group_by(label,abandonment)%>%
  summarize(total=n()) %>%
    group_by(label) %>%
  mutate(
    percent = total / sum(total) * 100))

 

ggplot(abandonment_combined, aes(x = label, y = percent, fill = abandonment)) +
  geom_bar(stat = "identity", color = "black") +
  # Show individual sample sizes inside each stack
  geom_text(
    aes(label = paste0("n=", total)),   # use total for each segment
    position = position_stack(vjust = 0.5),  # centers text in each segment
    size = 6,                           # larger geom_text labels
    color = "white"
  ) +
  scale_y_continuous() +
  labs(x = "", y = "Proportion of ants") +
  theme_minimal(base_size = 14) +
  theme(
    axis.text.x  = element_text(hjust = 0.5, size = 13),  
    axis.text.y  = element_text(size = 16),               
    axis.title.y = element_text(size = 18),               
    legend.title = element_text(size = 18),              
    panel.grid.major.x = element_blank()
  ) +
  geom_hline(yintercept = 50, linetype = "dashed") +
  scale_x_discrete(labels = c(
    "Control_1.5m" = "Control (1.5 M)",
    "Control_3m"   = "Control (3 M)",
    "Exp_1.5m"     = "Experimental (1.5 M)",
    "Exp_3m"       = "Experimental (3 M)"
  )) +
  guides(fill = guide_legend(title = "Abandonment")) +
  scale_fill_manual(values = c("violet", "gray50"))


```


GASTER ANGLE DATA ANALYSIS
```{r}

#LOW SUCROSE EXPERIMENT
gaster_angle_low_sucrose<-read.csv("Combined gaster angles_Low sucrose experiment.csv")

#Converting the relevant columns to factors
gaster_angle_low_sucrose$Ant.choice<-as.factor(gaster_angle_low_sucrose$Ant.choice)
gaster_angle_low_sucrose$Treatment<-as.factor(gaster_angle_low_sucrose$Treatment)
gaster_angle_low_sucrose$Video<-as.factor(gaster_angle_low_sucrose$Video)
gaster_angle_low_sucrose$Year<-as.factor(gaster_angle_low_sucrose$Year)
gaster_angle_low_sucrose$Ant.fed.on.the.feeder<-as.factor(gaster_angle_low_sucrose$Ant.fed.on.the.feeder)

#Converting gaster angle measures to numbers
gaster_angle_low_sucrose$Angle.measurement.1<-as.numeric(gaster_angle_low_sucrose$Angle.measurement.1)
gaster_angle_low_sucrose$Angle.measurement.2<-as.numeric(gaster_angle_low_sucrose$Angle.measurement.2)
gaster_angle_low_sucrose$Angle.measurement.3<-as.numeric(gaster_angle_low_sucrose$Angle.measurement.3)
#Ignore the warnings here


#HIGH SUCROSE EXPERIMENT
gaster_angle_high_sucrose<-read.csv("Combined gaster angles_High sucrose experiment.csv")

#Converting the relevant columns to factors
gaster_angle_high_sucrose$Ant.choice<-as.factor(gaster_angle_high_sucrose$Ant.choice)
gaster_angle_high_sucrose$Treatment<-as.factor(gaster_angle_high_sucrose$Treatment)
gaster_angle_high_sucrose$Video<-as.factor(gaster_angle_high_sucrose$Video)
gaster_angle_high_sucrose$Year<-as.factor(gaster_angle_high_sucrose$Year)
gaster_angle_high_sucrose$Ant.fed.on.the.feeder<-as.factor(gaster_angle_high_sucrose$Ant.fed.on.the.feeder)


#Converting gaster angle measures to numbers
gaster_angle_high_sucrose$Angle.measurement.1<-as.numeric(gaster_angle_high_sucrose$Angle.measurement.1)
gaster_angle_high_sucrose$Angle.measurement.2<-as.numeric(gaster_angle_high_sucrose$Angle.measurement.2)
gaster_angle_high_sucrose$Angle.measurement.3<-as.numeric(gaster_angle_high_sucrose$Angle.measurement.3)
#Ignore the warnings here

```


 
Taking the averages of the gaster angle across a given frame in a video, and across multiple frames for a video.
IMP Note: We only analyzed gaster angles for the ants that made a correct choice in both treatments across the two experiments.

```{r}

#LOW SUCROSE EXPERIMENT
 
gaster_angle_low_sucrose_ready<-gaster_angle_low_sucrose %>%
  transmute(Video,Treatment,Ant.choice,Ant.fed.on.the.feeder, Year,mean_gaster_angle=rowMeans(select(.,Angle.measurement.1:Angle.measurement.3)))

gaster_angle_low_sucrose_ready<-as.data.frame(gaster_angle_low_sucrose_ready %>%
  group_by(Video,Treatment,Ant.choice,Ant.fed.on.the.feeder,Year) %>%
  summarise(mean_gaster_angle=mean(mean_gaster_angle,na.rm = T)))

gaster_angle_low_sucrose_ready<-na.omit(gaster_angle_low_sucrose_ready)


#HIGH SUCROSE EXPERIMENT

gaster_angle_high_sucrose_ready<-gaster_angle_high_sucrose %>%
  transmute(Video,Treatment,Ant.choice,Ant.fed.on.the.feeder,Year,mean_gaster_angle=rowMeans(select(.,Angle.measurement.1:Angle.measurement.3)))

gaster_angle_high_sucrose_ready<-as.data.frame(gaster_angle_high_sucrose_ready %>%
  group_by(Video,Treatment,Ant.choice,Ant.fed.on.the.feeder,Year) %>%
  summarise(mean_gaster_angle=mean(mean_gaster_angle,na.rm = T)))

gaster_angle_high_sucrose_ready<-na.omit(gaster_angle_high_sucrose_ready)


#Summary of ants that made choices and fed on feeder or not
low_sucrose_summary<-gaster_angle_low_sucrose_ready[,c(2,3,4)]
table(low_sucrose_summary)

high_sucrose_summary<-gaster_angle_high_sucrose_ready[,c(2,3,4)]
table(high_sucrose_summary)

#Average gaster angle calculations:
gaster_angle_low_sucrose_ready %>%
  group_by(Treatment) %>%
  summarise(mean(mean_gaster_angle))

gaster_angle_high_sucrose_ready %>%
  group_by(Treatment) %>%
  summarise(mean(mean_gaster_angle))

```


 
Subsetting gaster angles as per ant choices and whether the ants fed or not

```{r}
#Low sucrose


#This contains data for the ants that made correct choices, and also includes the ants that made a wrong choice, but did not feed on the sucrose
gaster_angle_low_sucrose_graph1<-rbind(gaster_angle_low_sucrose_wrong_choices_unfed,gaster_angle_low_sucrose_correct_choices)

ggplot(gaster_angle_low_sucrose_graph1,aes(Treatment,mean_gaster_angle,fill=Ant.choice))+stat_boxplot(geom="errorbar")+geom_boxplot(outlier.shape = NA)+ theme_minimal()+xlab("Treatment")+ylab("Average gaster angle")+geom_jitter(aes(color=Year))+ggtitle("Low sucrose experiment")+guides(fill=guide_legend(title="Ant choice"))

#Comparing gaster angles for correct vs. wrong choices within the treatment

exp_low_sucrose_data_exp<-gaster_angle_low_sucrose_graph1 %>%
  filter(Treatment=="Experimental")
wilcox.test(exp_low_sucrose_data_exp$mean_gaster_angle~exp_low_sucrose_data_exp$Ant.choice) 
#No Significant difference


#High sucrose
#Low sucrose
gaster_angle_high_sucrose_wrong_choices_unfed<-subset(gaster_angle_high_sucrose_ready,Ant.fed.on.the.feeder=="No" & Ant.choice=="Wrong")

gaster_angle_high_sucrose_correct_choices<-subset(gaster_angle_high_sucrose_ready,Ant.choice=="Correct")

#This contains data for the ants that made correct choices, and also includes the ants that made a wrong choice, but did not feed on the sucrose
gaster_angle_high_sucrose_graph1<-rbind(gaster_angle_high_sucrose_wrong_choices_unfed,gaster_angle_high_sucrose_correct_choices)

ggplot(gaster_angle_high_sucrose_graph1,aes(Treatment,mean_gaster_angle,fill=Ant.choice))+stat_boxplot(geom="errorbar")+geom_boxplot(outlier.shape = NA)+ theme_minimal()+xlab("Treatment")+ylab("Average gaster angle")+geom_jitter(aes(color=Year))+ggtitle("High sucrose experiment")+guides(fill=guide_legend(title="Ant choice"))

#Comparing gaster angles for correct vs. wrong choices within the treatment

exp_high_sucrose_data_exp<-gaster_angle_high_sucrose_graph1 %>%
  filter(Treatment=="Experimental")
wilcox.test(exp_high_sucrose_data_exp$mean_gaster_angle~exp_high_sucrose_data_exp$Ant.choice) 
#Significant difference


exp_high_sucrose_data_con<-gaster_angle_high_sucrose_graph1 %>%
  filter(Treatment=="Control")
wilcox.test(exp_high_sucrose_data_con$mean_gaster_angle~exp_high_sucrose_data_con$Ant.choice) 
#Significant difference
 
  
```
 

Wilcoxon test to analyze whether there the gaster angles differ between control and experimental treatments for both experiments.
```{r}
wilcox.test(gaster_angle_low_sucrose_ready$mean_gaster_angle~gaster_angle_low_sucrose_ready$Treatment) 
#No Significant difference

wilcox.test(gaster_angle_high_sucrose_ready$mean_gaster_angle~gaster_angle_high_sucrose_ready$Treatment) 
#No significant difference



```

Boxplots for the gaster angles for both experiments with experiment years shown using different symbols

```{r}

par(mfrow=c(1,2))

#LOW SUCROSE EXPERIMENT
boxplot(gaster_angle_low_sucrose_ready$mean_gaster_angle~gaster_angle_low_sucrose_ready$Treatment,xlab="Treatment", ylab="Mean gaster angle (degrees)",range=0,frame=F,cex.axis=1.5,cex.lab=1.5,main="Low sucrose (1.5 M) experiment",ylim=c(35,65))

#Adding individual points to the boxplot
stripchart(mean_gaster_angle~Treatment,method="jitter",add=T,vertical=T,pch=1,data=gaster_angle_low_sucrose_ready[gaster_angle_low_sucrose_ready$Year==2022, ])
 
stripchart(mean_gaster_angle~Treatment,method="jitter",add=T,vertical=T,pch=19,data=gaster_angle_low_sucrose_ready[gaster_angle_low_sucrose_ready$Year==2023, ])

stripchart(mean_gaster_angle~Treatment,method="jitter",add=T,vertical=T,pch=18,data=gaster_angle_low_sucrose_ready[gaster_angle_low_sucrose_ready$Year==2024, ])

stripchart(mean_gaster_angle~Treatment,method="jitter",add=T,vertical=T,pch=17,data=gaster_angle_low_sucrose_ready[gaster_angle_low_sucrose_ready$Year==2025, ])


#HIGH SUCROSE EXPERIMENT
boxplot(gaster_angle_high_sucrose_ready$mean_gaster_angle~gaster_angle_high_sucrose_ready$Treatment,xlab="Treatment", ylab="Mean gaster angle (degrees)",range=0,frame=F,cex.axis=1.5,cex.lab=1.5,main="High sucrose (3 M) experiment",ylim=c(35,65))

#Adding individual points to the boxplot
stripchart(mean_gaster_angle~Treatment,method="jitter",add=T,vertical=T,pch=19,data=gaster_angle_high_sucrose_ready[gaster_angle_high_sucrose_ready$Year==2023, ])

stripchart(mean_gaster_angle~Treatment,method="jitter",add=T,vertical=T,pch=18,data=gaster_angle_high_sucrose_ready[gaster_angle_high_sucrose_ready$Year==2024, ])

stripchart(mean_gaster_angle~Treatment,method="jitter",add=T,vertical=T,pch=17,data=gaster_angle_high_sucrose_ready[gaster_angle_high_sucrose_ready$Year==2025, ])


```


