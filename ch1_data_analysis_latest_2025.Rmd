---
title: "ch1_data_analysis"
author: "Chinmay Joshi"
date: "2023-02-07"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Required libraries
```{r}
library(tidyverse)
library(googlesheets4)
library(ggplot2)
library(ggthemes)
library(ggstats)
```

 
Importing data from analysis ready datasheets in the google drive for the videos that were analyzed to get the average gaster angle for each trial. Followed by that converting relevant columns to factors and numbers

Fall 2022 data
```{r}

fall_2022_gaster_angle<-as.data.frame(read_sheet("https://docs.google.com/spreadsheets/d/1FPRGuBRdiHnLm_N69nAY1XQ4KUyYbEUaDxLwup3Zw-8/edit#gid=0"))

fall_2022_gaster_angle$`Location of the ant`<-as.factor(fall_2022_gaster_angle$`Location of the ant`)

fall_2022_gaster_angle$`Ant choice`<-as.factor(fall_2022_gaster_angle$`Ant choice`)

fall_2022_gaster_angle$Treatment<-as.factor(fall_2022_gaster_angle$Treatment)

fall_2022_gaster_angle$Video<-as.factor(fall_2022_gaster_angle$Video)

fall_2022_gaster_angle$`Angle measurement 1`<-as.numeric(fall_2022_gaster_angle$`Angle measurement 1`)

fall_2022_gaster_angle$`Angle measurement 2`<-as.numeric(fall_2022_gaster_angle$`Angle measurement 2`)

fall_2022_gaster_angle$`Angle measurement 3`<-as.numeric(fall_2022_gaster_angle$`Angle measurement 3`)

#Ignore the warnings here
```

Subsetting zone 1 data (area on the setup where the perturbation was introduced). Then it is followed by taking average for a given frame, and then averaging over all the frames for a given video to get the final usuable datasheet.

```{r}
fall_2022_gaster_angle<-subset(fall_2022_gaster_angle,fall_2022_gaster_angle$`Location of the ant`=="Zone1")
fall_2022_gaster_angle$`Gaster touching the paper`<-as.factor(fall_2022_gaster_angle$`Gaster touching the paper`)

fall_2022_gaster_angle<-fall_2022_gaster_angle %>%
  transmute(Video,Treatment,`Ant choice`,mean_gaster_angle=rowMeans(select(.,`Angle measurement 1`:`Angle measurement 3`)))

fall_2022_gaster_angle<-fall_2022_gaster_angle %>%
  group_by(Video,Treatment,`Ant choice`) %>%
  summarise(mean_gaster_angle=mean(mean_gaster_angle,na.rm = T))

#Dataframe to be used for the analysis. This also contains gaster angles for the ants that abandoned.
fall_2022_gaster_angle<-as.data.frame(fall_2022_gaster_angle)

```


IMP: I'm only analyzing gaster angle data for the ants that made a correct choices across both the treatments
```{r}
#Fall 2022 data

fall_2022_gaster_angle<-as.data.frame(subset(fall_2022_gaster_angle,fall_2022_gaster_angle$`Ant choice`=="Correct"))


#Importing Fall 2023 data and doing similar tranformations as above

fall_2023_data_gaster<-read_sheet("https://docs.google.com/spreadsheets/d/17etkrXmeS3bdT7omTB1WCpzjvrimKpTp73nBw-TwXyY/edit?gid=0#gid=0")
fall_2023_data_gaster<-as.data.frame(fall_2023_data_gaster)
fall_2023_data_gaster$`Ant choice`<-as.factor(fall_2023_data_gaster$`Ant choice`)
fall_2023_data_gaster$Treatment<-as.factor(fall_2023_data_gaster$Treatment)
fall_2023_data_gaster$Video<-as.factor(fall_2023_data_gaster$Video)
fall_2023_data_gaster$`Angle measurement 1`<-as.numeric(fall_2023_data_gaster$`Angle measurement 1`)
fall_2023_data_gaster$`Angle measurement 2`<-as.numeric(fall_2023_data_gaster$`Angle measurement 2`)
fall_2023_data_gaster$`Angle measurement 3`<-as.numeric(fall_2023_data_gaster$`Angle measurement 3`)
#Ignore the warnings here

#Averaging the three gaster angle measurements for a given frame
fall_2023_data_gaster_modified<-fall_2023_data_gaster %>%
  transmute(Video,Treatment,`Ant choice`,mean_gaster_angle=rowMeans(select(.,`Angle measurement 1`:`Angle measurement 3`)))

#Averaging gaster angles over all the frames for a given video
fall_2023_data_gaster_modified<-fall_2023_data_gaster_modified %>%
  group_by(Video,Treatment,`Ant choice`) %>%
  summarise(mean_gaster_angle=mean(mean_gaster_angle,na.rm = T))

fall_2023_data_gaster_modified<-as.data.frame(fall_2023_data_gaster_modified)

#Subsetting gaster angles for only correct choices and only for control
fall_2023_data_gaster_modified<-as.data.frame(subset(fall_2023_data_gaster_modified,fall_2023_data_gaster_modified$`Ant choice`=="Correct"))


#Fall 2024 1.5 M data

fall_2024_data_gaster<-read_sheet("https://docs.google.com/spreadsheets/d/1ifcf4M9CofkZ9rsHJ0VCdBB_zm3pyKrX6OlZthDkhvc/edit?gid=0#gid=0", sheet = "1.5M_data")
fall_2024_data_gaster<-as.data.frame(fall_2024_data_gaster)
fall_2024_data_gaster$Video<-as.factor(fall_2024_data_gaster$Video)
fall_2024_data_gaster$Treatment<-as.factor(fall_2024_data_gaster$Treatment)
fall_2024_data_gaster$`Angle measurement 1`<-as.numeric(fall_2024_data_gaster$`Angle measurement 1`)
fall_2024_data_gaster$`Angle measurement 2`<-as.numeric(fall_2024_data_gaster$`Angle measurement 2`)
fall_2024_data_gaster$`Angle measurement 3`<-as.numeric(fall_2024_data_gaster$`Angle measurement 3`)
#Ignore the warnings here

#Averaging the three gaster angle measurements for a given frame
fall_2024_data_gaster_modified<-fall_2024_data_gaster %>%
  transmute(Video,Treatment,mean_gaster_angle=rowMeans(select(.,`Angle measurement 1`:`Angle measurement 3`)))

#Averaging gaster angles over all the frames for a given video
fall_2024_data_gaster_modified<-fall_2024_data_gaster_modified %>%
  group_by(Video,Treatment) %>%
  summarise(mean_gaster_angle=mean(mean_gaster_angle,na.rm = T))

fall_2024_data_gaster_modified<-as.data.frame(fall_2024_data_gaster_modified)

fall_2022_gaster_angle$year<-2022
fall_2023_data_gaster_modified$year<-2023
fall_2024_data_gaster_modified$year<-2024

#Combining fall 2022 and fall 2023 gaster angle data
 
combined_gaster_angle<-rbind(fall_2022_gaster_angle,fall_2023_data_gaster_modified)

combined_gaster_angle<-combined_gaster_angle[-3]
 
#Combining this will Fall 2024 data

combined_gaster_angle<-rbind(combined_gaster_angle,fall_2024_data_gaster_modified)

combined_gaster_angle$f_year<-as.factor(combined_gaster_angle$year)

 
wilcox.test(combined_gaster_angle$mean_gaster_angle~combined_gaster_angle$Treatment)

#boxplot gaster angles
boxplot(combined_gaster_angle$mean_gaster_angle~combined_gaster_angle$Treatment,xlab="Treatment", ylab="Mean gaster angle (degrees)",range=0,frame=F,cex.axis=1.5,cex.lab=1.5)

#adding individual points to the boxplot
stripchart(combined_gaster_angle$mean_gaster_angle~combined_gaster_angle$Treatment,method="jitter",add=T,vertical=T,pch=19)
 

```


3M data

```{r}
#Fall 2023 data

fall_2023_data_gaster_3m<-read_sheet("https://docs.google.com/spreadsheets/d/17etkrXmeS3bdT7omTB1WCpzjvrimKpTp73nBw-TwXyY/edit?gid=0#gid=0",sheet="3M data")
fall_2023_data_gaster_3m<-as.data.frame(fall_2023_data_gaster_3m)
fall_2023_data_gaster_3m$`Ant choice`<-as.factor(fall_2023_data_gaster_3m$`Ant choice`)
fall_2023_data_gaster_3m$Treatment<-as.factor(fall_2023_data_gaster_3m$Treatment)
fall_2023_data_gaster_3m$Video<-as.factor(fall_2023_data_gaster_3m$Video)
fall_2023_data_gaster_3m$`Angle measurement 1`<-as.numeric(fall_2023_data_gaster_3m$`Angle measurement 1`)
fall_2023_data_gaster_3m$`Angle measurement 2`<-as.numeric(fall_2023_data_gaster_3m$`Angle measurement 2`)
fall_2023_data_gaster_3m$`Angle measurement 3`<-as.numeric(fall_2023_data_gaster_3m$`Angle measurement 3`)
#Ignore the warnings here

#Averaging the three gaster angle measurements for a given frame
fall_2023_data_gaster_modified_3m<-fall_2023_data_gaster_3m %>%
  transmute(Video,Treatment,`Ant choice`,mean_gaster_angle=rowMeans(select(.,`Angle measurement 1`:`Angle measurement 3`)))

#Averaging gaster angles over all the frames for a given video
fall_2023_data_gaster_modified_3m<-fall_2023_data_gaster_modified_3m %>%
  group_by(Video,Treatment,`Ant choice`) %>%
  summarise(mean_gaster_angle=mean(mean_gaster_angle,na.rm = T))

fall_2023_data_gaster_modified_3m<-as.data.frame(fall_2023_data_gaster_modified_3m)

#Subsetting gaster angles for only correct choices and only for control
fall_2023_data_gaster_modified_3m<-as.data.frame(subset(fall_2023_data_gaster_modified_3m,fall_2023_data_gaster_modified_3m$`Ant choice`=="Correct"))

fall_2023_data_gaster_modified_3m<-fall_2023_data_gaster_modified_3m[-3]

fall_2023_data_gaster_modified_3m$year<-2023
 

#Fall 2024 data

fall_2024_data_gaster_3m<-read_sheet("https://docs.google.com/spreadsheets/d/1ifcf4M9CofkZ9rsHJ0VCdBB_zm3pyKrX6OlZthDkhvc/edit?gid=0#gid=0",sheet ="3M_data")
fall_2024_data_gaster_3m<-as.data.frame(fall_2024_data_gaster_3m)
fall_2024_data_gaster_3m$Treatment<-as.factor(fall_2024_data_gaster_3m$Treatment)
fall_2024_data_gaster_3m$Video<-as.factor(fall_2024_data_gaster_3m$Video)
fall_2024_data_gaster_3m$`Angle measurement 1`<-as.numeric(fall_2024_data_gaster_3m$`Angle measurement 1`)
fall_2024_data_gaster_3m$`Angle measurement 2`<-as.numeric(fall_2024_data_gaster_3m$`Angle measurement 2`)
fall_2024_data_gaster_3m$`Angle measurement 3`<-as.numeric(fall_2024_data_gaster_3m$`Angle measurement 3`)
 

#Averaging the three gaster angle measurements for a given frame
fall_2024_data_gaster_modified_3m<-fall_2024_data_gaster_3m %>%
  transmute(Video,Treatment,mean_gaster_angle=rowMeans(select(.,`Angle measurement 1`:`Angle measurement 3`)))

#Averaging gaster angles over all the frames for a given video
fall_2024_data_gaster_modified_3m<-fall_2024_data_gaster_modified_3m %>%
  group_by(Video,Treatment) %>%
  summarise(mean_gaster_angle=mean(mean_gaster_angle,na.rm = T))

fall_2024_data_gaster_modified_3m<-as.data.frame(fall_2024_data_gaster_modified_3m)


fall_2024_data_gaster_modified_3m$year<-2024

combined_gaster_angle_3m<-rbind(fall_2023_data_gaster_modified_3m,fall_2024_data_gaster_modified_3m)

combined_gaster_angle_3m$f_year<-as.factor(combined_gaster_angle_3m$year)

combined_gaster_angle_3m %>%
  group_by(Treatment)%>%
  summarize(n(),median(mean_gaster_angle,na.rm=T))
  
 
wilcox.test(combined_gaster_angle_3m$mean_gaster_angle~combined_gaster_angle_3m$Treatment)

#Boxplot of the gaster angles
boxplot(combined_gaster_angle_3m$mean_gaster_angle~combined_gaster_angle_3m$Treatment,xlab="Treatment", ylab="Mean gaster angle (degrees)",range=0,frame=F,cex.axis=1.5,cex.lab=1.5)

stripchart(combined_gaster_angle_3m$mean_gaster_angle~combined_gaster_angle_3m$Treatment,method="jitter",add=T,vertical=T,pch=19)

 
```


```{r}

par(mfrow=c(1,2))
#1.5m
#boxplot gaster angles
boxplot(combined_gaster_angle$mean_gaster_angle~combined_gaster_angle$Treatment,xlab="Treatment", ylab="Mean gaster angle (degrees)",range=0,frame=F,cex.axis=1.5,cex.lab=1.5,main="Low sucrose experiment",ylim=c(35,65))

#adding individual points to the boxplot
stripchart(mean_gaster_angle~Treatment,method="jitter",add=T,vertical=T,pch=1,data=combined_gaster_angle[combined_gaster_angle$year==2022, ])
 
stripchart(mean_gaster_angle~Treatment,method="jitter",add=T,vertical=T,pch=19,data=combined_gaster_angle[combined_gaster_angle$year==2023, ])

stripchart(mean_gaster_angle~Treatment,method="jitter",add=T,vertical=T,pch=18,data=combined_gaster_angle[combined_gaster_angle$year==2024, ])

#3M
#Boxplot of the gaster angles
boxplot(combined_gaster_angle_3m$mean_gaster_angle~combined_gaster_angle_3m$Treatment,xlab="Treatment", ylab="Mean gaster angle (degrees)",range=0,frame=F,cex.axis=1.5,cex.lab=1.5,main="High sucrose experiment",ylim=c(35,65))

stripchart(mean_gaster_angle~Treatment,method="jitter",add=T,vertical=T,pch=19,data=combined_gaster_angle_3m[combined_gaster_angle_3m$year==2023, ])

stripchart(mean_gaster_angle~Treatment,method="jitter",add=T,vertical=T,pch=18,data=combined_gaster_angle_3m[combined_gaster_angle_3m$year==2024, ])

```


###################################################################
ANALYZING CHOICE and ABANDONMENT DATA FOR BOTH ExPERIMENTS
################################################################

 
```{r}
#Importing the datasheets,and converting the relevant columns into factors

low_sucrose_experiment_data<-as.data.frame(read_sheet("https://docs.google.com/spreadsheets/d/1wCr7QqkCmjw9DGSQ6-SlD-O_suCwDQFs8sp-kTLeGmA/edit?gid=0#gid=0",sheet="Low sucrose experiment"))

high_sucrose_experiment_data<-as.data.frame(read_sheet("https://docs.google.com/spreadsheets/d/1wCr7QqkCmjw9DGSQ6-SlD-O_suCwDQFs8sp-kTLeGmA/edit?gid=0#gid=0",sheet="High sucrose experiment"))

#Extracting the columns needed for choice and abandonment analysis
low_sucrose_experiment_choices<-data.frame(low_sucrose_experiment_data$`Treatment (Control/Experimental)`,low_sucrose_experiment_data$`Ant choice`)
high_sucrose_experiment_choices<-data.frame(high_sucrose_experiment_data$`Treatment (Control/Experimental)`,high_sucrose_experiment_data$`Ant choice`)

#Changing the column names
colnames(low_sucrose_experiment_choices)<-c("treatment","choices")
colnames(high_sucrose_experiment_choices)<-c("treatment","choices")

#Converting the columns into factors
low_sucrose_experiment_choices$treatment<-as.factor(low_sucrose_experiment_choices$treatment)
low_sucrose_experiment_choices$choices<-as.factor(low_sucrose_experiment_choices$choices)

high_sucrose_experiment_choices$treatment<-as.factor(high_sucrose_experiment_choices$treatment)
high_sucrose_experiment_choices$choices<-as.factor(high_sucrose_experiment_choices$choices)
```


ANALYZING CORRECT VS. WRONG CHOICES
```{r}

#1.5M DATA CHOICE ANALYSIS

#Filtering data where ant made either a correct or a wrong choice
low_sucrose_experiment_choices_only<-
  low_sucrose_experiment_choices %>% 
  filter(choices !="Abandoned")

#Dropping the abandonment factor level
low_sucrose_experiment_choices_only$choices<-droplevels(low_sucrose_experiment_choices_only$choices)

#Creating table
low_sucrose_experiment_choices_only_table<-table(low_sucrose_experiment_choices_only)

chisq.test(low_sucrose_experiment_choices_only_table,correct = F)

#Binomial test for control data
binom.test(23,27,0.5)
#Significant!

#Binomial test for experimental data
binom.test(4,12,0.5)
#Non-significant 
 
#3M DATA CHOICE ANALYSIS

#Filtering data where ant made either a correct or a wrong choice
high_sucrose_experiment_choices_only<-
  high_sucrose_experiment_choices %>% 
  filter(choices !="Abandoned")

#Dropping the abandonment factor level
high_sucrose_experiment_choices_only$choices<-droplevels(high_sucrose_experiment_choices_only$choices)

#Creating table
high_sucrose_experiment_choices_only_table<-table(high_sucrose_experiment_choices_only)

chisq.test(high_sucrose_experiment_choices_only_table,correct = F)
#Significant

#Binomial test for control data
binom.test(25,31,0.5)
#Significant!

#Binomial test for experimental data
binom.test(9,18,0.5)
#Non-significant 
```


ANALYZING ABANDONMENT DATA

```{r}
#1.5M DATA ABANDONMENT ANALYSIS

#Filtering data where ant made either a correct or a wrong choice
low_sucrose_experiment_choices$abandonment<-ifelse(low_sucrose_experiment_choices$choices=="Abandoned","Abandoned","On-trail")

low_sucrose_experiment_abandonment_table<-table(low_sucrose_experiment_choices[-2])

#Chi-square test
chisq.test(low_sucrose_experiment_abandonment_table,correct = F)
#Significant

#Binomial test for control data
binom.test(5,32,0.5)
#Significantly more ants stay on the trail than abandon here

#Binomial test for experimental data
binom.test(39,51,0.5)
#Significantly more ants abandon the trail than stay on the trail

#3M DATA ABANDONMENT ANALYSIS


#Filtering data where ant made either a correct or a wrong choice
high_sucrose_experiment_choices$abandonment<-ifelse(high_sucrose_experiment_choices$choices=="Abandoned","Abandoned","On-trail")

high_sucrose_experiment_abandonment_table<-table(high_sucrose_experiment_choices[-2])

#Chi-square test
chisq.test(high_sucrose_experiment_abandonment_table,correct = F)
#Significant


#Binomial test for control data
binom.test(2,33,0.5) #Significant
#Significantly more ants stay on the trail than abandon here

#Binomial test for experimental data
binom.test(22,40,0.5)
#Non-significant

```

 
###################################################################
COMPARING 1.5M AND 3M EXPERIMENTS TO FIND IF THE SUCROSE CONCENTRATION INCREASE CHANGED CHOICE MAKING OR ABANDONMENT PATTERN IN ANTS
#####################################################################


Comparing correct vs. wrong choices across 1.5M and 3M treatments
```{r}

#Creating labels specific to the experiment type and combining the dataframes
low_sucrose_experiment_choices$label<-as.factor(ifelse(low_sucrose_experiment_choices$treatment=="Control","Control_1.5m","Exp_1.5m"))

high_sucrose_experiment_choices$label<-as.factor(ifelse(high_sucrose_experiment_choices$treatment=="Control","Control_3m","Exp_3m"))

all_exp_combined_data_choices<-rbind(low_sucrose_experiment_choices,high_sucrose_experiment_choices)

#Substting the data from the two treatments (combined for both experiments seperately) to compare between the experiments.
all_exp_combined_control<-subset(all_exp_combined_data_choices,all_exp_combined_data_choices$treatment=="Control")

all_exp_combined_experimental<-subset(all_exp_combined_data_choices,all_exp_combined_data_choices$treatment=="Experimental")

#Dropping the uncessary factor levels
all_exp_combined_control$label<-droplevels(all_exp_combined_control$label)

all_exp_combined_experimental$label<-droplevels(all_exp_combined_experimental$label)

#COMPARING CORRECT VS. WRONG CHOICES BETWEEN THE EXPERIMENTS FOR EACH TREATMENT

#CONTROL
all_exp_combined_control_choices_only<-data.frame(all_exp_combined_control$choices,all_exp_combined_control$label)

colnames(all_exp_combined_control_choices_only)<-c("choices","exp_type")

#Removing abandonment data for this analysis
all_exp_combined_control_choices_only<-subset(all_exp_combined_control_choices_only,all_exp_combined_control_choices_only$choices!="Abandoned")

#Dropping the uncessary factor levels
all_exp_combined_control_choices_only$choices<-droplevels(all_exp_combined_control_choices_only$choices)

all_exp_combined_control_choices_only_table<-table(all_exp_combined_control_choices_only)

chisq.test(all_exp_combined_control_choices_only_table,correct = F)
#Not significant

#EXPERIMENTAL

all_exp_combined_experimental_choices_only<-data.frame(all_exp_combined_experimental$choices,all_exp_combined_experimental$label)

colnames(all_exp_combined_experimental_choices_only)<-c("choices","exp_type")

#Removing abandonment data for this analysis
all_exp_combined_experimental_choices_only<-subset(all_exp_combined_experimental_choices_only,all_exp_combined_experimental_choices_only$choices!="Abandoned")

#Dropping the uncessary factor levels
all_exp_combined_experimental_choices_only$choices<-droplevels(all_exp_combined_experimental_choices_only$choices)

all_exp_combined_experimental_choices_only_table<-table(all_exp_combined_experimental_choices_only)

chisq.test(all_exp_combined_experimental_choices_only_table,correct = F)
#Not significant

#Plots
new_df<-subset(all_exp_combined_data_choices,choices!="Abandoned")
#Removing abandonment data for the plot

new_df$label<-factor(new_df$label,levels=c("Control_1.5m","Control_3m","Exp_1.5m","Exp_3m"))

new_df<-as.data.frame(new_df %>%
  group_by(label,choices)%>%
  summarize(total=n()))

choices_plot<-ggplot(new_df)+
  aes(label,fill=choices,weight=total,by=label)+
  geom_bar(position="fill")+
  geom_text(aes(label = scales::percent(..prop.., accuracy = 1)),stat = "prop", position = position_fill(.5),size=7)+
  scale_y_continuous(labels = scales::percent)+scale_x_discrete(labels=c("Control_1.5m"="Control 1.5M","Control_3m"= "Control 3M", "Exp_1.5m"="Experimental 1.5M","Exp_3m" = "Experimental 3M"))+
  xlab("Treatments")+
  ylab("Percentage ants")+
  guides(fill=guide_legend(title="Choices"))+
  theme_bw()+
    theme(
    plot.background = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank()
  ) +  theme(axis.line = element_line(color = 'black'))
   

choices_plot+theme(text=element_text(size=25),axis.text = element_text(size=19))+ 
  geom_hline(yintercept = 0.5, linetype = "dashed")+
  scale_fill_manual(values=c("orange1","gray50"))


 #Plotting only 1.5M choices
new_df_low_sucrose<-new_df[c(1,2,5,6),]

choices_plot_low_sucrose<-ggplot(new_df_low_sucrose)+
  aes(label,fill=choices,weight=total,by=label)+
  geom_bar(position="fill")+
  geom_text(aes(label = scales::percent(..prop.., accuracy = 1)),stat = "prop", position = position_fill(.5),size=7)+
  scale_y_continuous(labels = scales::percent)+scale_x_discrete(labels=c("Control_1.5m"="Control 1.5M", "Exp_1.5m"="Experimental 1.5M"))+
  xlab("Treatments")+
  ylab("Percentage ants")+
  guides(fill=guide_legend(title="Choices"))+
  theme_bw()+
    theme(
    plot.background = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank()
  ) +  theme(axis.line = element_line(color = 'black'))
   

choices_plot_low_sucrose+theme(text=element_text(size=25),axis.text = element_text(size=19))+ 
  geom_hline(yintercept = 0.5, linetype = "dashed") 

#Plotting only 3M choices
new_df_high_sucrose<-new_df[c(3,4,7,8),]

choices_plot_high_sucrose<-ggplot(new_df_high_sucrose)+
  aes(label,fill=choices,weight=total,by=label)+
  geom_bar(position="fill")+
  geom_text(aes(label = scales::percent(..prop.., accuracy = 1)),stat = "prop", position = position_fill(.5),size=7)+
  scale_y_continuous(labels = scales::percent)+scale_x_discrete(labels=c("Control_3m"="Control 3M", "Exp_3m"="Experimental 3M"))+
  xlab("Treatments")+
  ylab("Percentage ants")+
  guides(fill=guide_legend(title="Choices"))+
  theme_bw()+
    theme(
    plot.background = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank()
  ) +  theme(axis.line = element_line(color = 'black'))
   
choices_plot_high_sucrose+theme(text=element_text(size=25),axis.text = element_text(size=19))+ 
  geom_hline(yintercept = 0.5, linetype = "dashed") 

 

```

Comparing abandonment across 1.5M and 3M treatments

```{r}

#CONTROL
all_exp_combined_control_abandonment_only<-data.frame(all_exp_combined_control$abandonment,all_exp_combined_control$label)

colnames(all_exp_combined_control_abandonment_only)<-c("abandonment","exp_type")

all_exp_combined_control_abandonment_only$abandonment<-as.factor(all_exp_combined_control_abandonment_only$abandonment)

all_exp_combined_control_abandonment_only_table<-table(all_exp_combined_control_abandonment_only)

chisq.test(all_exp_combined_control_abandonment_only_table,correct = F)
#Not significant


#Experimental
all_exp_combined_experimental_abandonment_only<-data.frame(all_exp_combined_experimental$abandonment,all_exp_combined_experimental$label)

colnames(all_exp_combined_experimental_abandonment_only)<-c("abandonment","exp_type")

all_exp_combined_experimental_abandonment_only$abandonment<-as.factor(all_exp_combined_experimental_abandonment_only$abandonment)

all_exp_combined_experimental_abandonment_only_table<-table(all_exp_combined_experimental_abandonment_only)

chisq.test(all_exp_combined_experimental_abandonment_only_table,correct = F)
#Significant!


#Plots

new_df_1<-as.data.frame(all_exp_combined_data_choices %>%
  group_by(label,abandonment)%>%
  summarize(total=n()))

new_df_1$label<-factor(new_df_1$label,levels=c("Control_1.5m","Control_3m","Exp_1.5m","Exp_3m"))

choices_plot_1<-ggplot(new_df_1)+
  aes(label,fill=abandonment,weight=total,by=label)+
  geom_bar(position="fill")+
  geom_text(aes(label = scales::percent(..prop.., accuracy = 1)),stat = "prop", position = position_fill(.5),size=7)+
  scale_y_continuous(labels = scales::percent)+scale_x_discrete(labels=c("Control_1.5m"="Control 1.5M","Control_3m"= "Control 3M", "Exp_1.5m"="Experimental 1.5M","Exp_3m" = "Experimental 3M"))+
  xlab("Treatments")+
  ylab("Percentage ants")+
  guides(fill=guide_legend(title="Abandoned or not"))+
  theme_bw()+
    theme(
    plot.background = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank()
  ) +  theme(axis.line = element_line(color = 'black'))
   
choices_plot_1+theme(text=element_text(size=25),axis.text = element_text(size=17))+geom_hline(yintercept = 0.5, linetype = "dashed")+scale_fill_manual(values=c("skyblue1","maroon3"))


#Plotting abandonment data only for low sucrose
new_df_1_low_sucrose<-new_df_1[c(1,2,3,4),]

choices_plot_1_low_sucrose<-ggplot(new_df_1_low_sucrose)+
  aes(label,fill=abandonment,weight=total,by=label)+
  geom_bar(position="fill")+
  geom_text(aes(label = scales::percent(..prop.., accuracy = 1)),stat = "prop", position = position_fill(.5),size=7)+
  scale_y_continuous(labels = scales::percent)+scale_x_discrete(labels=c("Control_1.5m"="Control 1.5M", "Exp_1.5m"="Experimental 1.5M"))+
  xlab("Treatments")+
  ylab("Percentage ants")+
  guides(fill=guide_legend(title="Abandoned or not"))+
  theme_bw()+
    theme(
    plot.background = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank()
  ) +  theme(axis.line = element_line(color = 'black'))
   
choices_plot_1_low_sucrose+theme(text=element_text(size=25),axis.text = element_text(size=17))+geom_hline(yintercept = 0.5, linetype = "dashed")+scale_fill_manual(values=c("skyblue1","maroon3"))


#Plotting abandonment data only for high sucrose

new_df_1_high_sucrose<-new_df_1[c(5,6,7,8),]

choices_plot_1_high_sucrose<-ggplot(new_df_1_high_sucrose)+
  aes(label,fill=abandonment,weight=total,by=label)+
  geom_bar(position="fill")+
  geom_text(aes(label = scales::percent(..prop.., accuracy = 1)),stat = "prop", position = position_fill(.5),size=7)+
  scale_y_continuous(labels = scales::percent)+scale_x_discrete(labels=c("Control_3m"="Control 3M", "Exp_3m"="Experimental 3M"))+
  xlab("Treatments")+
  ylab("Percentage ants")+
  guides(fill=guide_legend(title="Abandoned or not"))+
  theme_bw()+
    theme(
    plot.background = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank()
  ) +  theme(axis.line = element_line(color = 'black'))
   
choices_plot_1_high_sucrose+theme(text=element_text(size=25),axis.text = element_text(size=17))+geom_hline(yintercept = 0.5, linetype = "dashed")+scale_fill_manual(values=c("skyblue1","maroon3"))

```



 


 

