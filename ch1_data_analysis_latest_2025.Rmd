---
title: "ch1_data_analysis"
author: "Chinmay Joshi"
date: "2023-02-07"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Required libraries
```{r}
library(tidyverse)
#library(googlesheets4)
library(ggplot2)
library(ggthemes)
library(ggstats)
```

ANALYZING CHOICE and ABANDONMENT DATA FOR BOTH EXPERIMENTS
 
```{r}
#Importing the datasheets,and converting the relevant columns into factors

low_sucrose_experiment_data<-read.csv("Combined ant choices_Low sucrose experiment.csv")

high_sucrose_experiment_data<-read.csv("Combined ant choices_High sucrose experiment.csv")

#Extracting the columns needed for choice and abandonment analysis
low_sucrose_experiment_choices<-data.frame(low_sucrose_experiment_data$Treatment,low_sucrose_experiment_data$Ant.choice)
high_sucrose_experiment_choices<-data.frame(high_sucrose_experiment_data$Treatment,high_sucrose_experiment_data$Ant.choice)

#Changing the column names
colnames(low_sucrose_experiment_choices)<-c("treatment","choices")
colnames(high_sucrose_experiment_choices)<-c("treatment","choices")

#Converting the columns into factors
low_sucrose_experiment_choices$treatment<-as.factor(low_sucrose_experiment_choices$treatment)
low_sucrose_experiment_choices$choices<-as.factor(low_sucrose_experiment_choices$choices)

high_sucrose_experiment_choices$treatment<-as.factor(high_sucrose_experiment_choices$treatment)
high_sucrose_experiment_choices$choices<-as.factor(high_sucrose_experiment_choices$choices)
```


ANALYZING CORRECT VS. WRONG CHOICES FOR EACH EXPERIMENT
```{r}

#1.5M DATA CHOICE ANALYSIS

#Filtering data where ant made either a correct or a wrong choice
low_sucrose_experiment_choices_only<-
  low_sucrose_experiment_choices %>% 
  filter(choices !="Abandoned")

#Dropping the abandonment factor level
low_sucrose_experiment_choices_only$choices<-droplevels(low_sucrose_experiment_choices_only$choices)

#Creating table
low_sucrose_experiment_choices_only_table<-table(low_sucrose_experiment_choices_only)

chisq.test(low_sucrose_experiment_choices_only_table,correct = F)

#Binomial test for control data
binom.test(23,27,0.5)
#Significant!

#Binomial test for experimental data
binom.test(4,12,0.5)
#Non-significant 
 
#3M DATA CHOICE ANALYSIS

#Filtering data where ant made either a correct or a wrong choice
high_sucrose_experiment_choices_only<-
  high_sucrose_experiment_choices %>% 
  filter(choices !="Abandoned")

#Dropping the abandonment factor level
high_sucrose_experiment_choices_only$choices<-droplevels(high_sucrose_experiment_choices_only$choices)

#Creating table
high_sucrose_experiment_choices_only_table<-table(high_sucrose_experiment_choices_only)

chisq.test(high_sucrose_experiment_choices_only_table,correct = F)
#Significant

#Binomial test for control data
binom.test(25,31,0.5)
#Significant!

#Binomial test for experimental data
binom.test(9,18,0.5)
#Non-significant 
```


ANALYZING ABANDONMENT DATA FOR EACH EXPERIMENT

```{r}

#LOW SUCROSE EXPERIMENT ABANDONMENT ANALYSIS

#Filtering data where ant made either a correct or a wrong choice
low_sucrose_experiment_choices$abandonment<-ifelse(low_sucrose_experiment_choices$choices=="Abandoned","Abandoned","On-trail")

low_sucrose_experiment_abandonment_table<-table(low_sucrose_experiment_choices[-2])

#Chi-square test
chisq.test(low_sucrose_experiment_abandonment_table,correct = F)
#Significant

#Binomial test for control data
binom.test(5,32,0.5)
#Significantly more ants stay on the trail than abandon here

#Binomial test for experimental data
binom.test(39,51,0.5)
#Significantly more ants abandon the trail than stay on the trail

#HIGH SUCROSE EXPERIMENT ABANDONMENT ANALYSIS

#Filtering data where ant made either a correct or a wrong choice
high_sucrose_experiment_choices$abandonment<-ifelse(high_sucrose_experiment_choices$choices=="Abandoned","Abandoned","On-trail")

high_sucrose_experiment_abandonment_table<-table(high_sucrose_experiment_choices[-2])

#Chi-square test
chisq.test(high_sucrose_experiment_abandonment_table,correct = F)
#Significant


#Binomial test for control data
binom.test(2,33,0.5) #Significant
#Significantly more ants stay on the trail than abandon here

#Binomial test for experimental data
binom.test(22,40,0.5)
#Non-significant

```

 
COMPARING LOW AND HIGH SUCROSE EXPERIMENTS TO FIND IF THE SUCROSE CONCENTRATION INCREASE RESULTED IN ANY CHANGES IN THE CHOICES AND/OR ABANDONMENT IN ANTS
 
Comparing correct vs. wrong choices across two experiments

Labels:
1.5m-Low sucrose experiment
3m- High sucrose experiment
```{r}

#Creating labels specific to the experiment type and combining the dataframes
low_sucrose_experiment_choices$label<-as.factor(ifelse(low_sucrose_experiment_choices$treatment=="Control","Control_1.5m","Exp_1.5m"))

high_sucrose_experiment_choices$label<-as.factor(ifelse(high_sucrose_experiment_choices$treatment=="Control","Control_3m","Exp_3m"))


#Combining the choices from both experiments
all_exp_combined_data_choices<-rbind(low_sucrose_experiment_choices,high_sucrose_experiment_choices)

#Subsetting the data from the two treatments (combined for both experiments separately) to compare between the experiments.
all_exp_combined_control<-subset(all_exp_combined_data_choices,all_exp_combined_data_choices$treatment=="Control")

all_exp_combined_experimental<-subset(all_exp_combined_data_choices,all_exp_combined_data_choices$treatment=="Experimental")

#Dropping the uncessary factor levels
all_exp_combined_control$label<-droplevels(all_exp_combined_control$label)

all_exp_combined_experimental$label<-droplevels(all_exp_combined_experimental$label)

#COMPARING CORRECT VS. WRONG CHOICES BETWEEN THE TWO EXPERIMENTS FOR EACH TREATMENT

#CONTROL TREATMENT
all_exp_combined_control_choices_only<-data.frame(all_exp_combined_control$choices,all_exp_combined_control$label)

colnames(all_exp_combined_control_choices_only)<-c("choices","exp_type")

#Removing abandonment data for this analysis
all_exp_combined_control_choices_only<-subset(all_exp_combined_control_choices_only,all_exp_combined_control_choices_only$choices!="Abandoned")

#Dropping the uncessary factor levels
all_exp_combined_control_choices_only$choices<-droplevels(all_exp_combined_control_choices_only$choices)

all_exp_combined_control_choices_only_table<-table(all_exp_combined_control_choices_only)

chisq.test(all_exp_combined_control_choices_only_table,correct = F)
#Not significant

#EXPERIMENTAL TREATMENT

all_exp_combined_experimental_choices_only<-data.frame(all_exp_combined_experimental$choices,all_exp_combined_experimental$label)

colnames(all_exp_combined_experimental_choices_only)<-c("choices","exp_type")

#Removing abandonment data for this analysis
all_exp_combined_experimental_choices_only<-subset(all_exp_combined_experimental_choices_only,all_exp_combined_experimental_choices_only$choices!="Abandoned")

#Dropping the uncessary factor levels
all_exp_combined_experimental_choices_only$choices<-droplevels(all_exp_combined_experimental_choices_only$choices)

all_exp_combined_experimental_choices_only_table<-table(all_exp_combined_experimental_choices_only)

chisq.test(all_exp_combined_experimental_choices_only_table,correct = F)
#Not significant
```


Comparing abandonment across both experiments.

Labels:
1.5m-Low sucrose experiment
3m- High sucrose experiment

```{r}

#CONTROL
all_exp_combined_control_abandonment_only<-data.frame(all_exp_combined_control$abandonment,all_exp_combined_control$label)

colnames(all_exp_combined_control_abandonment_only)<-c("abandonment","exp_type")

all_exp_combined_control_abandonment_only$abandonment<-as.factor(all_exp_combined_control_abandonment_only$abandonment)

all_exp_combined_control_abandonment_only_table<-table(all_exp_combined_control_abandonment_only)

chisq.test(all_exp_combined_control_abandonment_only_table,correct = F)
#Not significant


#Experimental
all_exp_combined_experimental_abandonment_only<-data.frame(all_exp_combined_experimental$abandonment,all_exp_combined_experimental$label)

colnames(all_exp_combined_experimental_abandonment_only)<-c("abandonment","exp_type")

all_exp_combined_experimental_abandonment_only$abandonment<-as.factor(all_exp_combined_experimental_abandonment_only$abandonment)

all_exp_combined_experimental_abandonment_only_table<-table(all_exp_combined_experimental_abandonment_only)

chisq.test(all_exp_combined_experimental_abandonment_only_table,correct = F)
#Significant!
```


BOXPLOTS OF ANT CHOICES ACROSS BOTH EXPERIMENTS
```{r}

choices_combined<-subset(all_exp_combined_data_choices,choices!="Abandoned")
#Removing abandonment data for the plot

choices_combined$label<-factor(choices_combined$label,levels=c("Control_1.5m","Control_3m","Exp_1.5m","Exp_3m"))

choices_combined<-as.data.frame(choices_combined %>%
  group_by(label,choices)%>%
  summarize(total=n()))

choices_plot<-ggplot(choices_combined)+
  aes(label,fill=choices,weight=total,by=label)+
  geom_bar(position="fill")+
  geom_text(aes(label = scales::percent(..prop.., accuracy = 1)),stat = "prop", position = position_fill(.5),size=7)+
  scale_y_continuous(labels = scales::percent)+scale_x_discrete(labels=c("Control_1.5m"="Control 1.5M","Control_3m"= "Control 3M", "Exp_1.5m"="Experimental 1.5M","Exp_3m" = "Experimental 3M"))+
  xlab("Treatments")+
  ylab("Percentage ants")+
  guides(fill=guide_legend(title="Choices"))+
  theme_bw()+
    theme(
    plot.background = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank()
  ) +  theme(axis.line = element_line(color = 'black'))
   

choices_plot+theme(text=element_text(size=25),axis.text = element_text(size=19))+ 
  geom_hline(yintercept = 0.5, linetype = "dashed")+
  scale_fill_manual(values=c("orange1","gray50"))

```

BOXPLOTS OF ABANDONMENT ACROSS BOTH EXPERIMENTS
```{r}
 
abandon_combined<-as.data.frame(all_exp_combined_data_choices %>%
  group_by(label,abandonment)%>%
  summarize(total=n()))

abandon_combined$label<-factor(abandon_combined$label,levels=c("Control_1.5m","Control_3m","Exp_1.5m","Exp_3m"))

choices_plot_1<-ggplot(abandon_combined)+
  aes(label,fill=abandonment,weight=total,by=label)+
  geom_bar(position="fill")+
  geom_text(aes(label = scales::percent(..prop.., accuracy = 1)),stat = "prop", position = position_fill(.5),size=7)+
  scale_y_continuous(labels = scales::percent)+scale_x_discrete(labels=c("Control_1.5m"="Control 1.5M","Control_3m"= "Control 3M", "Exp_1.5m"="Experimental 1.5M","Exp_3m" = "Experimental 3M"))+
  xlab("Treatments")+
  ylab("Percentage ants")+
  guides(fill=guide_legend(title="Abandoned or not"))+
  theme_bw()+
    theme(
    plot.background = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_blank()
  ) +  theme(axis.line = element_line(color = 'black'))
   
choices_plot_1+theme(text=element_text(size=25),axis.text = element_text(size=17))+geom_hline(yintercept = 0.5, linetype = "dashed")+scale_fill_manual(values=c("skyblue1","maroon3"))
```


GASTER ANGLE DATA ANALYSIS
```{r}

#LOW SUCROSE EXPERIMENT
gaster_angle_low_sucrose<-read.csv("Combined gaster angles_Low sucrose experiment.csv")

#Converting the relevant columns to factors
gaster_angle_low_sucrose$Location.of.the.ant<-as.factor(gaster_angle_low_sucrose$Location.of.the.ant)
 
gaster_angle_low_sucrose$Ant.choice<-as.factor(gaster_angle_low_sucrose$Ant.choice)
gaster_angle_low_sucrose$Treatment<-as.factor(gaster_angle_low_sucrose$Treatment)
gaster_angle_low_sucrose$Video<-as.factor(gaster_angle_low_sucrose$Video)
gaster_angle_low_sucrose$Year<-as.factor(gaster_angle_low_sucrose$Year)

#Converting gaster angle measures to numbers
gaster_angle_low_sucrose$Angle.measurement.1<-as.numeric(gaster_angle_low_sucrose$Angle.measurement.1)
gaster_angle_low_sucrose$Angle.measurement.2<-as.numeric(gaster_angle_low_sucrose$Angle.measurement.2)
gaster_angle_low_sucrose$Angle.measurement.3<-as.numeric(gaster_angle_low_sucrose$Angle.measurement.3)
#Ignore the warnings here


#HIGH SUCROSE EXPERIMENT
gaster_angle_high_sucrose<-read.csv("Combined gaster angles_High sucrose experiment.csv")

#Converting the relevant columns to factors
  
gaster_angle_high_sucrose$Ant.choice<-as.factor(gaster_angle_high_sucrose$Ant.choice)
gaster_angle_high_sucrose$Treatment<-as.factor(gaster_angle_high_sucrose$Treatment)
gaster_angle_high_sucrose$Video<-as.factor(gaster_angle_high_sucrose$Video)
gaster_angle_high_sucrose$Year<-as.factor(gaster_angle_high_sucrose$Year)


#Converting gaster angle measures to numbers
gaster_angle_high_sucrose$Angle.measurement.1<-as.numeric(gaster_angle_high_sucrose$Angle.measurement.1)
gaster_angle_high_sucrose$Angle.measurement.2<-as.numeric(gaster_angle_high_sucrose$Angle.measurement.2)
gaster_angle_high_sucrose$Angle.measurement.3<-as.numeric(gaster_angle_high_sucrose$Angle.measurement.3)
#Ignore the warnings here

```

Subsetting zone 1 data (area on the setup where the perturbation was introduced). Then it is followed by taking average for a given frame, and then averaging over all the frames for a given video to get the final usuable datasheet. Only for low sucrose experiment data in Fall 2022, the data were collected for zone1 and zone2. For fall 2023 and 2024, all the data were collected in zone1 for both experiment types

```{r}

#LOW SUCROSE EXPERIMENT
gaster_angle_low_sucrose_ready<-subset(gaster_angle_low_sucrose,gaster_angle_low_sucrose$Location.of.the.ant=="Zone1")

gaster_angle_low_sucrose_ready<-gaster_angle_low_sucrose_ready %>%
  transmute(Video,Treatment,Ant.choice,Year,mean_gaster_angle=rowMeans(select(.,Angle.measurement.1:Angle.measurement.3)))

gaster_angle_low_sucrose_ready<-as.data.frame(gaster_angle_low_sucrose_ready %>%
  group_by(Video,Treatment,Ant.choice,Year) %>%
  summarise(mean_gaster_angle=mean(mean_gaster_angle,na.rm = T)))

#HIGH SUCROSE EXPERIMENT

gaster_angle_high_sucrose_ready<-gaster_angle_high_sucrose %>%
  transmute(Video,Treatment,Ant.choice,Year,mean_gaster_angle=rowMeans(select(.,Angle.measurement.1:Angle.measurement.3)))

gaster_angle_high_sucrose_ready<-as.data.frame(gaster_angle_high_sucrose_ready %>%
  group_by(Video,Treatment,Ant.choice,Year) %>%
  summarise(mean_gaster_angle=mean(mean_gaster_angle,na.rm = T)))

```

IMP: I'm only analyzing gaster angle data for the ants that made a correct choices across both the treatments. So, I'm subsetting the data where ants made correct choices. These are the two dataframes that will be used for further analyses.

```{r}
 
gaster_angle_low_sucrose_ready<-na.omit(subset(gaster_angle_low_sucrose_ready,gaster_angle_low_sucrose_ready$Ant.choice=="Correct"))

gaster_angle_high_sucrose_ready<-na.omit(subset(gaster_angle_high_sucrose_ready,gaster_angle_high_sucrose_ready$Ant.choice=="Correct"))

```


Wilcoxon test to analyze whether there the gaster angles differ between control and experimental treatments for both experiments.
```{r}
wilcox.test(gaster_angle_low_sucrose_ready$mean_gaster_angle~gaster_angle_low_sucrose_ready$Treatment) #Significant difference

wilcox.test(gaster_angle_high_sucrose_ready$mean_gaster_angle~gaster_angle_high_sucrose_ready$Treatment) #No significant difference

```

Boxplots for the gaster angles for both experiments with experiment years shown using different symbols

```{r}

par(mfrow=c(1,2))

#LOW SUCROSE EXPERIMENT
boxplot(gaster_angle_low_sucrose_ready$mean_gaster_angle~gaster_angle_low_sucrose_ready$Treatment,xlab="Treatment", ylab="Mean gaster angle (degrees)",range=0,frame=F,cex.axis=1.5,cex.lab=1.5,main="Low sucrose (1.5 M) experiment",ylim=c(35,65))

#Adding individual points to the boxplot
stripchart(mean_gaster_angle~Treatment,method="jitter",add=T,vertical=T,pch=1,data=gaster_angle_low_sucrose_ready[gaster_angle_low_sucrose_ready$Year==2022, ])
 
stripchart(mean_gaster_angle~Treatment,method="jitter",add=T,vertical=T,pch=19,data=gaster_angle_low_sucrose_ready[gaster_angle_low_sucrose_ready$Year==2023, ])

stripchart(mean_gaster_angle~Treatment,method="jitter",add=T,vertical=T,pch=18,data=gaster_angle_low_sucrose_ready[gaster_angle_low_sucrose_ready$Year==2024, ])

#HIGH SUCROSE EXPERIMENT
boxplot(gaster_angle_high_sucrose_ready$mean_gaster_angle~gaster_angle_high_sucrose_ready$Treatment,xlab="Treatment", ylab="Mean gaster angle (degrees)",range=0,frame=F,cex.axis=1.5,cex.lab=1.5,main="High sucrose (3 M) experiment",ylim=c(35,65))

#Adding individual points to the boxplot
stripchart(mean_gaster_angle~Treatment,method="jitter",add=T,vertical=T,pch=19,data=gaster_angle_high_sucrose_ready[gaster_angle_high_sucrose_ready$Year==2023, ])

stripchart(mean_gaster_angle~Treatment,method="jitter",add=T,vertical=T,pch=18,data=gaster_angle_high_sucrose_ready[gaster_angle_high_sucrose_ready$Year==2024, ])

```


